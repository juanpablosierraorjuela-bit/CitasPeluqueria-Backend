{% load static %}
<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Panel de Control | PASO</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"><style>:root{--primary:#0f172a;--secondary:#475569;--accent:#db2777;--bg:#f8fafc;--surface:#ffffff;--success:#10b981;--border:#e2e8f0;--telegram:#229ED9;}body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--primary);margin:0;padding-bottom:40px;}.dashboard-header{background:var(--surface);padding:20px 30px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:50;}.brand{font-weight:800;font-size:1.5rem;display:flex;align-items:center;gap:10px;}.btn-logout{font-size:0.9rem;color:#ef4444;text-decoration:none;font-weight:600;padding:8px 15px;background:#fef2f2;border-radius:8px;}.container{max-width:1100px;margin:30px auto;padding:0 20px;}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:40px;}.stat-card{background:var(--surface);padding:20px;border-radius:16px;border:1px solid var(--border);box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);}.stat-val{font-size:2rem;font-weight:800;color:var(--accent);}.stat-label{color:var(--secondary);font-size:0.9rem;font-weight:600;}.tabs{display:flex;gap:10px;margin-bottom:25px;border-bottom:2px solid var(--border);padding-bottom:10px;overflow-x:auto;}.tab-btn{padding:10px 20px;border:none;background:none;font-weight:600;color:var(--secondary);cursor:pointer;border-radius:8px;transition:0.2s;white-space:nowrap;}.tab-btn.active{background:var(--primary);color:white;}.tab-content{display:none;animation:fadeIn 0.3s;}.tab-content.active{display:block;}.card{background:var(--surface);border-radius:16px;padding:30px;border:1px solid var(--border);margin-bottom:30px;}.form-group{margin-bottom:20px;}label{display:block;font-weight:700;font-size:0.9rem;margin-bottom:8px;color:var(--secondary);}input,select{width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-family:inherit;font-size:0.95rem;}.btn-save{background:var(--primary);color:white;border:none;padding:12px 25px;border-radius:8px;font-weight:700;cursor:pointer;width:100%;}.btn-telegram{background:var(--telegram);color:white;border:none;padding:12px 25px;border-radius:8px;font-weight:700;cursor:pointer;width:100%;display:flex;justify-content:center;gap:8px;align-items:center;}.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px;}.menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:15px;}.menu-item{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:25px;background:var(--surface);border:1px solid var(--border);border-radius:12px;text-decoration:none;color:var(--primary);transition:0.2s;font-weight:700;gap:10px;}.menu-item:hover{border-color:var(--accent);transform:translateY(-3px);}.menu-icon{font-size:1.8rem;color:var(--accent);}.pay-config-grid{display:grid;gap:30px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));}.pay-box{background:#f8fafc;padding:20px;border-radius:12px;border:1px solid var(--border);}table{width:100%;border-collapse:collapse;background:white;min-width:600px;}th,td{padding:15px;text-align:left;border-bottom:1px solid var(--border);font-size:0.9rem;}th{background:#f1f5f9;font-weight:700;color:var(--secondary);}.badge{padding:4px 10px;border-radius:20px;font-size:0.75rem;font-weight:700;}.bg-green{background:#dcfce7;color:#166534;}.bg-yellow{background:#fef9c3;color:#854d0e;}@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}</style></head><body><header class="dashboard-header"><div class="brand"><i class="fas fa-cut" style="color:var(--accent);"></i><span>PASO Manager</span></div><a href="{% url 'logout_usuario' %}" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Salir</a></header><div class="container">{% if alerta_pago %}<div style="padding:15px;background:#fff7ed;color:#c2410c;border:1px solid #fdba74;border-radius:10px;margin-bottom:20px;font-weight:600;"><i class="fas fa-exclamation-triangle"></i> {{ alerta_pago }} <a href="{% url 'pago_suscripcion_saas' %}" style="text-decoration:underline;">Pagar</a></div>{% endif %}{% if messages %}{% for message in messages %}<div style="padding:15px;background:#dcfce7;color:#166534;border:1px solid #86efac;border-radius:10px;margin-bottom:20px;"><i class="fas fa-check-circle"></i> {{ message }}</div>{% endfor %}{% endif %}<div class="stats-grid"><div class="stat-card"><div class="stat-val">{{ citas_hoy_count }}</div><div class="stat-label">Citas Hoy</div></div><div class="stat-card"><div class="stat-val">{{ empleados.count }}</div><div class="stat-label">Equipo</div></div><div class="stat-card"><div class="stat-val" style="font-size:1.2rem;">{{ proximo_pago|date:"d M" }}</div><div class="stat-label">Corte</div></div></div><div class="tabs"><button class="tab-btn active" onclick="openTab(event, 'tab-inicio')"> Men煤</button><button class="tab-btn" onclick="openTab(event, 'tab-citas')"> Gesti贸n Citas</button><button class="tab-btn" onclick="openTab(event, 'tab-config')">锔 Configuraci贸n</button><button class="tab-btn" onclick="openTab(event, 'tab-pagos')"> Pagos</button></div><div id="tab-inicio" class="tab-content active"><div class="menu-grid"><a href="{% url 'gestionar_servicios' %}" class="menu-item"><i class="fas fa-list menu-icon"></i><span>Servicios</span></a><a href="{% url 'gestionar_equipo' %}" class="menu-item"><i class="fas fa-users menu-icon"></i><span>Equipo</span></a><a href="{% url 'mi_agenda' %}" class="menu-item"><i class="fas fa-calendar-alt menu-icon"></i><span>Mi Agenda</span></a><a href="{% url 'pago_suscripcion_saas' %}" class="menu-item"><i class="fas fa-receipt menu-icon"></i><span>Suscripci贸n</span></a></div><div class="card" style="margin-top:30px;padding:20px;background:#eff6ff;"><h3 style="margin-top:0;font-size:1rem;color:#1e3a8a;"> Link Empleados</h3><div style="display:flex;gap:10px;"><input type="text" value="{{ link_invitacion }}" id="linkInput" readonly><button onclick="copiarLink()" class="btn-save" style="width:auto;background:#2563eb;">Copiar</button></div></div></div><div id="tab-citas" class="tab-content"><div class="card"><h2>Pr贸ximas Citas</h2><div style="overflow-x:auto;"><table><thead><tr><th>Fecha</th><th>Cliente</th><th>Tel</th><th>Total</th><th>Abono</th><th>Pendiente</th><th>Estado</th></tr></thead><tbody>{% for c in citas_futuras %}<tr><td>{{ c.fecha_hora_inicio|date:"d M, H:i" }}</td><td>{{ c.cliente_nombre }}</td><td>{{ c.cliente_telefono }}</td><td>${{ c.precio_total }}</td><td>${{ c.abono_pagado }} <small>({{ c.metodo_pago }})</small></td><td style="font-weight:bold;color:#db2777;">${{ c.saldo_pendiente }}</td><td>{% if c.estado == 'C' %}<span class="badge bg-green">Confirmada</span>{% else %}<span class="badge bg-yellow">Pendiente</span>{% endif %}</td></tr>{% empty %}<tr><td colspan="7" style="text-align:center;">No hay citas.</td></tr>{% endfor %}</tbody></table></div></div></div><div id="tab-config" class="tab-content"><div class="card"><h2>Datos y Notificaciones</h2><form method="POST">{% csrf_token %}<div class="form-group"><label>Direcci贸n</label><input type="text" name="direccion" value="{{ peluqueria.direccion }}"></div><div class="form-group"><label>Tel茅fono</label><input type="text" name="telefono" value="{{ peluqueria.telefono }}"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;"><div class="form-group"><label>Abre</label><input type="time" name="hora_apertura" value="{{ peluqueria.hora_apertura|time:'H:i' }}"></div><div class="form-group"><label>Cierra</label><input type="time" name="hora_cierre" value="{{ peluqueria.hora_cierre|time:'H:i' }}"></div></div><h3 style="margin-top:20px;font-size:1rem;">Telegram Bot</h3><div class="form-group"><label>Token</label><input type="password" name="telegram_token" value="{{ peluqueria.telegram_token|default:'' }}"></div><div class="form-group"><label>Chat ID</label><input type="text" name="telegram_chat_id" value="{{ peluqueria.telegram_chat_id|default:'' }}"></div><div class="btn-row"><button type="submit" name="accion" value="test_telegram" class="btn-telegram"><i class="fab fa-telegram-plane"></i> Probar Bot</button><button type="submit" name="accion" value="guardar_info" class="btn-save"><i class="fas fa-save"></i> Guardar</button></div></form></div></div><div id="tab-pagos" class="tab-content"><div class="card"><h2>Configuraci贸n de Cobros</h2><form method="POST" enctype="multipart/form-data">{% csrf_token %}<input type="hidden" name="accion" value="guardar_pagos"><div class="form-group"><label>Porcentaje Abono (%)</label><input type="number" name="porcentaje_abono" value="{{ peluqueria.porcentaje_abono }}" min="0" max="100"></div><div class="pay-config-grid"><div class="pay-box"><span style="font-weight:800;font-size:1.2rem;">BOLD</span><div class="form-group"><label>Llave de Identidad</label><input type="text" name="bold_api_key" value="{{ peluqueria.bold_api_key|default:'' }}"></div><div class="form-group"><label>Llave Secreta</label><input type="password" name="bold_secret_key" value="{{ peluqueria.bold_secret_key|default:'' }}"></div></div><div class="pay-box"><span style="font-weight:800;font-size:1.2rem;">NEQUI</span><div class="form-group"><label>Celular Nequi</label><input type="text" name="nequi_celular" value="{{ peluqueria.nequi_celular|default:'' }}"></div><div class="form-group"><label>QR Imagen</label>{% if peluqueria.nequi_qr_imagen %}<img src="{{ peluqueria.nequi_qr_imagen.url }}" style="max-width:80px;display:block;margin:5px 0;">{% endif %}<input type="file" name="nequi_qr_imagen" accept="image/*"></div></div></div><button type="submit" class="btn-save" style="margin-top:20px;">Guardar Pagos</button></form></div></div></div><script>function openTab(evt,name){document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById(name).classList.add('active');evt.currentTarget.classList.add('active');}function copiarLink(){var c=document.getElementById("linkInput");c.select();navigator.clipboard.writeText(c.value);alert("Link copiado!");}</script></body></html>
